package test;// Generated by Selenium IDE

import org.junit.Test;
import org.junit.runner.RunWith;
import org.openqa.selenium.By;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Actions;
import org.openqa.selenium.support.events.EventFiringWebDriver;
import org.openqa.selenium.support.ui.WebDriverWait;
import runner.SeleniumTestRunner;

// *** Regular maintenance is required for all locators (locators can be changed with updated code) ***

@RunWith(SeleniumTestRunner.class)
public final class TestScanImage {

  public static String login = System.getenv().getOrDefault("LOGIN", "super.admin@intelletive.com");
  public static String password = System.getenv().getOrDefault("PASSWORD", "123456");

  @Test
  public void scanimage() throws Exception {
      // wait until element is visible
      EventFiringWebDriver driver = SeleniumTestRunner.driver;
      WebDriverWait myWaitVar = new WebDriverWait(driver, 4);  

      driver.get(SeleniumTestRunner.baseURL + "/public/login");
      Actions action = new Actions(driver);

      // move to auth box -> click -> find Local -> click
      action.moveToElement(driver.findElement(By.id("authenticationmethod"))).click().sendKeys("Local").sendKeys(Keys.ENTER).click().build().perform();
      // enter credentials
      driver.findElement(By.id("email")).sendKeys(login);
      driver.findElement(By.id("password")).sendKeys(password);
      driver.findElement(By.id("submit\'")).click();

      // sleep to load page
      Thread.sleep(5000);

      // select on m9sweeper-dev-cluster
      driver.findElement(By.xpath("//mat-card/div/span[contains(text(),'default-cluster')]")).click();
      // select Images
      driver.findElement(By.xpath("//mat-list/a[@title='Images']")).click();
      // click on the Search bar
      driver.findElement(By.xpath("(//div/input[@type='search'])[2]")).click();
      // sleep to load
      Thread.sleep(2000);
      // type in an image name on Search Image
      driver.findElement(By.xpath("(//div/input[@type='search'])[2]")).sendKeys("docker.io/postgres");
      // sleep to load
      Thread.sleep(2000);
      // select first image
      driver.findElement(By.xpath("(//mat-cell[contains(text(),'docker.io')])[1]")).click();
      // click rescan
      driver.findElement(By.xpath("//span[contains(normalize-space(),'Rescan Image')]")).click();
      // sleep to load page
      Thread.sleep(15000);
      // click on profile and log out
      driver.findElement(By.xpath("//span[contains(@class, 'mat-menu-trigger')]/img[contains(@class, 'profile')]")).click();
      driver.findElement(By.xpath("//span[contains(normalize-space(), 'Sign Out')]")).click();

  }
}
